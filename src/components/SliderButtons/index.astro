---
import './styles.css'
import FloatingButton from '../FloatingButton/index.astro'
import { FiChevronLeft, FiChevronRight } from 'react-icons/fi'

const buttons = [
  {
    className: 'left',
    icon: FiChevronLeft
  },
  {
    className: 'right',
    icon: FiChevronRight
  }
]
---

<>
  {
    buttons.map((button) => (
      <FloatingButton className={`slider-button ${button.className}`}>
        <button.icon />
      </FloatingButton>
    ))
  }
</>

<script>
  const sliders = document.querySelectorAll(
    '.slider'
  ) as NodeListOf<HTMLElement>

  sliders.forEach((slider) => {
    const { parentElement } = slider

    if (!parentElement) return

    const leftButton = parentElement.querySelector(
      '.slider-button.left'
    ) as HTMLButtonElement
    const rightButton = parentElement.querySelector(
      '.slider-button.right'
    ) as HTMLButtonElement

    const handleArrowClick = (direction: 'left' | 'right') => {
      const { clientWidth, scrollLeft } = slider

      let move = 0

      if (direction === 'left') move = -clientWidth
      else move = clientWidth

      slider.scrollTo({
        left: scrollLeft + move,
        behavior: 'smooth'
      })
    }

    leftButton.addEventListener('click', () => handleArrowClick('left'))
    rightButton.addEventListener('click', () => handleArrowClick('right'))

    const handleDisablingButtons = () => {
      const { clientWidth, scrollLeft, scrollWidth } = slider

      console.log(scrollLeft, clientWidth, scrollWidth)

      if (scrollLeft === 0) {
        leftButton.disabled = true
      } else {
        leftButton.disabled = false
      }

      if (scrollLeft !== 0 && scrollLeft + clientWidth >= scrollWidth) {
        rightButton.disabled = true
      } else {
        rightButton.disabled = false
      }
    }

    slider.addEventListener('scroll', handleDisablingButtons)

    handleDisablingButtons()
  })
</script>
